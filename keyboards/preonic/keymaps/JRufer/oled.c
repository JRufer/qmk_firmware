/**
 * This contains all of the code specific to addressing the oled display
 */
#ifdef OLED_DRIVER_ENABLE
//Setup some mask which can be or'd with bytes to turn off pixels
const uint8_t single_bit_masks[8] = {127, 191, 223, 239, 247, 251, 253, 254};

//fade the display out
static void fade_display(void) {
    //Define the reader structure
    oled_buffer_reader_t reader;
    uint8_t buff_char;
    if (random() % 30 == 0) {
        srand(timer_read());
        // Fetch a pointer for the buffer byte at index 0. The return structure
        // will have the pointer and the number of bytes remaining from this
        // index position if we want to perform a sequential read by
        // incrementing the buffer pointer
        reader = oled_read_raw(0);
        //Loop over the remaining buffer and erase pixels as we go
        for (uint16_t i = 0; i < reader.remaining_element_count; i++) {
            //Get the actual byte in the buffer by dereferencing the pointer
            buff_char = *reader.current_element;
            if (buff_char != 0) {
                oled_write_raw_byte(buff_char & single_bit_masks[rand() % 8], i);
            }
            //increment the pointer to fetch a new byte during the next loop
            reader.current_element++;
        }
    }
}

//Custom Logo for kb startup
static void render_logo(void) {
    static const char PROGMEM logo[] = {
        // 'ninininOL', 128x32px
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0x80, 0x00, 0x0c, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00,
0x00, 0x00, 0x03, 0xc0, 0x00, 0x1e, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x3c, 0x00,
0x00, 0x00, 0x03, 0xc0, 0x00, 0x1e, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x3f, 0xf0, 0x3c, 0x00,
0x00, 0x00, 0x03, 0x80, 0x00, 0x1c, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x7f, 0xf0, 0x38, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x78, 0x38, 0x00,
0x00, 0xef, 0x80, 0x07, 0x7c, 0x00, 0x3b, 0xe0, 0x01, 0xdf, 0x00, 0x01, 0xf0, 0x38, 0x78, 0x00,
0x00, 0xff, 0xc7, 0x07, 0xfe, 0x38, 0x3f, 0xf1, 0xc1, 0xff, 0x80, 0x03, 0xe0, 0x38, 0x78, 0x00,
0x01, 0xff, 0xc7, 0x0f, 0xfe, 0x38, 0x7f, 0xf1, 0xc3, 0xff, 0x80, 0x03, 0xc0, 0x38, 0x70, 0x00,
0x01, 0xfb, 0xc7, 0x0f, 0xde, 0x38, 0x7e, 0xf1, 0xc3, 0xf7, 0x87, 0x07, 0x80, 0x38, 0xf0, 0x00,
0x01, 0xf3, 0xc7, 0x0f, 0x9e, 0x38, 0x7c, 0xf1, 0xc3, 0xe7, 0x8f, 0x07, 0x80, 0x78, 0xf0, 0x00,
0x03, 0xe3, 0x8f, 0x1f, 0x1c, 0x78, 0xf8, 0xe3, 0xc7, 0xc7, 0x0f, 0x0f, 0x00, 0x70, 0xe0, 0x00,
0x03, 0xc7, 0x8e, 0x1e, 0x3c, 0x70, 0xf1, 0xe3, 0x87, 0x8f, 0x0e, 0x0f, 0x00, 0xf0, 0xe0, 0x00,
0x03, 0x87, 0x8e, 0x1c, 0x3c, 0x70, 0xe1, 0xe3, 0x87, 0x0f, 0x00, 0x0e, 0x01, 0xe1, 0xe0, 0x70,
0x07, 0x87, 0x0e, 0x3c, 0x38, 0x71, 0xe1, 0xc3, 0x8f, 0x0e, 0x00, 0x0e, 0x03, 0xe1, 0xc3, 0xf0,
0x07, 0x0f, 0x1e, 0x38, 0x78, 0xf1, 0xc3, 0xc7, 0x8e, 0x1e, 0x00, 0x0f, 0x0f, 0xc1, 0xcf, 0xf0,
0x07, 0x0f, 0x1c, 0x38, 0x78, 0xe1, 0xc3, 0xc7, 0x0e, 0x1e, 0x00, 0x0f, 0xff, 0x81, 0xff, 0xc0,
0x07, 0x0e, 0x1c, 0x38, 0x70, 0xe1, 0xc3, 0x87, 0x0e, 0x1c, 0x00, 0x07, 0xfe, 0x01, 0xfe, 0x00,
0x07, 0x0e, 0x1c, 0x38, 0x70, 0xe1, 0xc3, 0x87, 0x0e, 0x1c, 0x00, 0x03, 0xf8, 0x00, 0xf8, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    oled_write_raw_P(logo, sizeOf(logo));

}
#endif
